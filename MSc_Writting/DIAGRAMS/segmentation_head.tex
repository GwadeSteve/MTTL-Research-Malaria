\begin{tikzpicture}[
    node distance=1.2cm and 1cm,
    block/.style={rectangle, draw, thick, fill=blue!15, rounded corners, minimum width=2.4cm, minimum height=0.7cm, align=center, font=\sffamily\small},
    feat_map/.style={cuboid, cuboidfill, minimum width=2.6cm, minimum height=0.55cm, font=\sffamily\tiny, fill=orange!30},
    op/.style={circle, draw, thick, fill=cyan!20, minimum size=0.7cm, font=\sffamily\tiny},
    out_map/.style={cuboid, fill=green!25, minimum width=1.8cm, minimum height=0.45cm, font=\sffamily\tiny},
    arrow/.style={-Stealth, thick, draw=black!70},
    skip_arrow/.style={-Stealth, thick, draw=cyan!60!black, dashed},
    dim_label_above/.style={midway, above, font=\tiny\ttfamily, text=black!60, yshift=1.5mm},
    % ADJUSTMENT: Changed 'midway' to 'pos=0.8' to move labels closer to the end of the arrow
    dim_label_right/.style={pos=0.2, right, font=\tiny\ttfamily, text=black!60, xshift=2mm},
    dim_label_on_arrow/.style={pos=0.5, above, font=\tiny\ttfamily, text=black!60}
]
    
    % --- TITLE ---
    \node[blocktitle, yshift=-0.5cm] (title) {};

    % --- INPUTS (Encoder Path) ---
    \node[feat_map, below=1.2cm of title] (c4_in) {C4\\16×16×2048};
    \node[feat_map, above=of c4_in] (c3_in) {C3\\32×32×1024};
    \node[feat_map, above=of c3_in] (c2_in) {C2\\64×64×512};
    \node[feat_map, above=of c2_in] (c1_in) {C1\\128×128×256};

    % --- DECODER PATH ---
    \node[block, right=4.5cm of c4_in] (d4) {Up-Conv + Fuse Block}; 
    \node[op, right=1.5cm of c4_in] (concat4) {+};

    \node[block, above=of d4] (d3) {Up-Conv + Fuse Block};
    \node[op, right=1.5cm of c3_in] (concat3) {+};

    \node[block, above=of d3] (d2) {Up-Conv + Fuse Block};
    \node[op, right=1.5cm of c2_in] (concat2) {+};
    
    \node[block, above=of d2, fill=violet!20] (final_conv) {Final Conv 1x1};
    \node[out_map, above=of final_conv] (output) {Mask Logits};

    % --- ARROWS (curved + straight) ---
    \draw[arrow] (c4_in) -- node[dim_label_above] {16x16x2048} (concat4);
    \draw[skip_arrow] (c3_in) -- node[dim_label_above] {32x32x1024} (concat4);
    \draw[arrow, bend right=30, looseness=1.5] (concat4.south east) to node[dim_label_on_arrow] {32x32x(1024+64)} (d4.west);

    % The labels on these two arrows will now be closer to the concat nodes
    \draw[arrow] (d4) -- node[dim_label_right] {32x32x64} (concat3);
    \draw[skip_arrow] (c2_in) -- node[dim_label_above] {64x64x512} (concat3);
    \draw[arrow, bend right=30, looseness=1.5] (concat3.south east) to node[dim_label_on_arrow] {64x64x(512+32)} (d3.west);

    \draw[arrow] (d3) -- node[dim_label_right] {64x64x32} (concat2);
    \draw[skip_arrow] (c1_in) -- node[dim_label_above] {128x128x256} (concat2);
    \draw[arrow, bend right=30, looseness=1.5] (concat2.south east) to node[dim_label_on_arrow] {128x128x(256+16)} (d2.west);

    \draw[arrow] (d2) -- node[dim_label_right] {128x128x16} (final_conv);
    \draw[arrow] (final_conv) -- node[dim_label_right, pos=0.5] {64x64x1} (output); % Kept this one centered

    % --- BACKGROUND GROUPING (with zone labels) ---
    \begin{scope}[on background layer]
        \node[draw=orange!50, fill=orange!5, rounded corners, inner sep=6pt,
              fit=(c1_in) (c4_in),
              label={[font=\sffamily\bfseries\tiny, text=orange!80!black, yshift=0.2cm]90:Backbone Features}] {};
        \node[draw=blue!50, fill=blue!5, rounded corners, inner sep=6pt,
              fit=(d2) (d3) (d4) (final_conv) (output) (concat2) (concat3) (concat4),
              label={[font=\sffamily\bfseries\tiny, text=blue!80!black, yshift=0.2cm]90:Decoder Path}] {};
    \end{scope}

\end{tikzpicture}