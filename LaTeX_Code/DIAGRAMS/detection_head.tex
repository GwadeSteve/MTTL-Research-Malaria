
    \begin{tikzpicture}[
        node distance=1.2cm and 0.8cm,
        block/.style={rectangle, draw, thick, fill=gray!20, rounded corners, minimum width=4cm, minimum height=0.9cm, align=center, font=\sffamily\small},
        trainable_block/.style={block, fill=violet!25, text=black!80},
        op/.style={rectangle, draw, thick, fill=violet!15, rounded corners, font=\sffamily\tiny, minimum height=0.55cm},
        arrow/.style={-Stealth, thick, draw=black!70, rounded corners=3pt},
        feat_map/.style={cuboid, cuboidfill, minimum width=2.5cm, minimum height=0.55cm, font=\sffamily\tiny, fill=orange!30},
        pyramid_map/.style={cuboid, cuboidfill, minimum width=2.2cm, minimum height=0.5cm, font=\sffamily\tiny, fill=cyan!20},
        out/.style={rectangle, draw, thick, fill=green!25, rounded corners, align=center, font=\sffamily\tiny, minimum width=2.8cm},
        % Custom arrows
        pyramid_arrow/.style={-Stealth, thick, draw=cyan!70, rounded corners=2pt, line width=1pt},
        proposal_arrow/.style={-Stealth, thick, draw=red!70!black, dashed, rounded corners=2pt, line width=1pt, font=\sffamily\tiny, red},
        dim_label_right/.style={midway, right, font=\tiny\ttfamily, text=black!60, xshift=2mm},
        dim_label_left/.style={midway, left, font=\tiny\ttfamily, text=black!60, xshift=-2mm}
    ]
    
    % TITLE
    \node[blocktitle] (title) {};
    
    % INPUTS
    \node[feat_map] (c3) {C3\\32×32×1024};
    \node[feat_map, left=0.15cm of c3] (c4) {C4\\16×16×2048};
    \node[feat_map, right=0.15cm of c3] (c2) {C2\\64×64×512};

    % FPN 
    \node[trainable_block, below=1.2cm of c3] (fpn) {Feature Pyramid Network (FPN)};

    % Pyramid Maps (P2–P4) 
    \node[pyramid_map] (p3) [below=1.4cm of fpn] {P3\\32×32×64};
    \node[pyramid_map, left=0.15cm of p3] (p4) {P4\\16×16×64};
    \node[pyramid_map, right=0.15cm of p3] (p2) {P2\\64×64×64};

    % Pyramid zone
    \begin{scope}[on background layer]
        \node[draw=cyan!70, fill=cyan!10, rounded corners, inner sep=4pt,
              fit=(p2) (p3) (p4),
              label={[font=\sffamily\bfseries\tiny, text=cyan!80!black]135:Feature Pyramid Maps (P2–P4)}] {};
    \end{scope}
    
    % RPN & RoIAlign
    \node[trainable_block, below=2cm of p3] (rpn) {Region Proposal Network};
    \node[block, right=1.2cm of rpn] (roi_align) {MultiScaleRoIAlign};

    % Lightweight Box Head
    \node[op, below=1.5cm of rpn, fill=violet!15] (head_conv) {Conv 3×3, BN, ReLU};
    \node[op, below=0.4cm of head_conv] (head_ds_conv) {Depthwise-Separable Conv};
    \node[op, below=0.4cm of head_ds_conv, fill=gray!20] (head_flatten) {Flatten};
    \node[op, below=0.4cm of head_flatten] (head_fc) {FC Layer};
    \node[op, below=0.4cm of head_fc] (predictor) {Predictor FC Layer};
    
    % Outputs
    \node[outnode, below left=0.7cm and 0.2cm of predictor] (class_out) {Class Scores};
    \node[outnode, below right=0.7cm and 0.2cm of predictor] (bbox_out) {BBox Offsets};

    % Connections
    % Backbone -> FPN
    \draw[arrow] (c2.south) -- (fpn.north);
    \draw[arrow] (c3.south) -- (fpn.north);
    \draw[arrow] (c4.south) -- (fpn.north);
    
    % FPN -> Pyramid Maps
    \draw[pyramid_arrow] (fpn.south) -- ++(0,-0.4) -| (p2.north);
    \draw[pyramid_arrow] (fpn.south) -- (p3.north);
    \draw[pyramid_arrow] (fpn.south) -- ++(0,-0.4) -| (p4.north);

    % Pyramid -> bus -> RPN & RoIAlign
    \coordinate (bus_top) at ($(p4.south)!0.5!(p2.south)$);
    \coordinate (bus_bottom) at ($(bus_top)+(0,-0.5cm)$);
    \draw[pyramid_arrow, line width=1.2pt] (bus_top) -- (bus_bottom);
    \draw[pyramid_arrow] (p2.south) -- ++(0,-0.15) -| (bus_top);
    \draw[pyramid_arrow] (p3.south) -- ++(0,-0.15) -| (bus_top);
    \draw[pyramid_arrow] (p4.south) -- ++(0,-0.15) -| (bus_top);
    \draw[pyramid_arrow] (bus_bottom) -- (rpn.north);
    \draw[pyramid_arrow] (bus_bottom) -- (roi_align.north);

    % RPN -> RoIAlign (Proposals)
    \draw[proposal_arrow] (rpn.east) -- node[midway, above, font=\sffamily\tiny] {Proposals} (roi_align.west);
    
    % RoIAlign -> Box Head 
    \draw[arrow] (roi_align.south) -- ++(0,-0.4) -| node[dim_label_right] {N×64×7×7} (head_conv.north);
    \draw[arrow] (head_conv) -- node[dim_label_left] {N×256×7×7} (head_ds_conv);
    \draw[arrow] (head_ds_conv) -- node[dim_label_left] {N×64×7×7} (head_flatten);
    \draw[arrow] (head_flatten) -- node[dim_label_left] {N×3136} (head_fc);
    \draw[arrow] (head_fc) -- node[dim_label_left] {N×256} (predictor);

    % Final Outputs
    \draw[arrow] (predictor.south) -- ++(0,-0.3) -| (class_out.north);
    \draw[arrow] (predictor.south) -- ++(0,-0.3) -| (bbox_out.north);

    \begin{scope}[on background layer]
        \node[draw=violet!60, fill=violet!10, rounded corners, inner sep=6pt,
              fit=(head_conv) (head_ds_conv) (head_flatten) (head_fc) (predictor),
              label={[font=\sffamily\bfseries\tiny, text=violet!80!black]135:Lightweight Box Head}] {};
    \end{scope}

\end{tikzpicture}
